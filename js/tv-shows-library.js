!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.TVShowsLibrary=t():e.TVShowsLibrary=t()}(window,function(){return function(e){var t={};function n(r){if(t[r])return t[r].exports;var o=t[r]={i:r,l:!1,exports:{}};return e[r].call(o.exports,o,o.exports,n),o.l=!0,o.exports}return n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)n.d(r,o,function(t){return e[t]}.bind(null,o));return r},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=0)}([function(e,t,n){"use strict";function r(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}n.r(t);var o=function(){function e(){var t,n,r;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),r=null,(n="xmlhttp")in(t=this)?Object.defineProperty(t,n,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[n]=r,this.xmlhttp=function(){if("undefined"!=typeof XMLHttpRequest)try{return new XMLHttpRequest}catch(e){}return null}()||function(){try{return new ActiveXObject("Msxml2.XMLHTTP")}catch(e){try{return new ActiveXObject("Microsoft.XMLHTTP")}catch(e){}}return null}()||function(){if(window.createRequest)try{return window.createRequest()}catch(e){}return null}()}var t,n,o;return t=e,(n=[{key:"fetchAsynchronously",value:function(e,t){var n=this;this.xmlhttp.abort(),this.xmlhttp.open("GET",e),this.xmlhttp.onreadystatechange=function(){200===n.xmlhttp.status&&4==n.xmlhttp.readyState&&t(n.responseText)},this.xmlhttp.send(null)}},{key:"fetchSynchronously",value:function(e){return this.xmlhttp.abort(),this.xmlhttp.open("GET",e,!1),this.xmlhttp.send(null),200===this.xmlhttp.status?this.xmlhttp.responseText:null}},{key:"response",get:function(){return{status:this.xmlhttp.status,response:this.xmlhttp.responseText}}}])&&r(t.prototype,n),o&&r(t,o),e}(),i="http://image.tmdb.org/t/p";function s(e,t){return i+"/w"+t+e}function u(e){return{total:e.total_results,page:e.page||1,pagesNb:e.total_pages||1,results:e.results.map(function(e){return{originalName:(t=e).original_name||null,TMDBId:t.id||null,name:t.name||null,thumbnail:t.poster_path?s(t.poster_path,92):null,poster:t.poster_path?s(t.poster_path,500):null,overview:t.overview||null};var t})}}function l(e){return{name:e.name||null,backdrop:e.backdrop_path?s(e.backdrop_path,780):null,firstAirDate:e.first_air_date,genres:e.genres?e.genres.map(function(e){return e.name}):[],url:e.homepage,inProduction:e.in_production,episodesNb:e.number_of_episodes,seasonsNb:e.number_of_seasons,originalName:e.original_name||null,overview:e.overview,thumbnail:e.poster_path?s(e.poster_path,92):null,poster:e.poster_path?s(e.poster_path,500):null,seasons:e.seasons?e.seasons.map(function(e){return{episodesNb:(t=e).episode_count||null,name:t.name||null,overview:t.overview||null,thumbnail:t.poster_path?s(t.poster_path,92):null,poster:t.poster_path?s(t.poster_path,500):null,number:t.season_number};var t}):[],score:0}}function a(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var c="http://api.themoviedb.org/3";function f(e,t){return c+e+"?"+function(e){return Object.entries(e).map(function(e){return encodeURIComponent(e[0])+"="+encodeURIComponent(e[1])}).join("&")}(t)}function h(e,t,n,r){var i=new o;if("function"!=typeof r){var s=i.fetchSynchronously(f(e,t)),u=null!==s?JSON.parse(s):{};return n(u)}i.fetchAsynchronously(f(e,t),function(e){var t=200===e.status?JSON.parse(e.responseText):{};r(n(t))})}var p,d,g,v=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}var t,n,r;return t=e,r=[{key:"search",value:function(e,t){return h("/search/tv",{api_key:e,language:"fr-FR",query:t,page:arguments.length>2&&void 0!==arguments[2]?arguments[2]:1},u,arguments.length>3?arguments[3]:void 0)}},{key:"detail",value:function(e,t,n){return h("/tv/"+t,{api_key:e,language:"fr-FR"},l,n)}},{key:"getGenres",value:function(){return["Action & Adventure","Animation","Comédie","Crime","Documentaire","Drame","Familial","Kids","Mystère","News","Reality","Science-Fiction & Fantastique","Soap","Talk","War & Politics","Western"]}}],(n=null)&&a(t.prototype,n),r&&a(t,r),e}();g="fr-FR",(d="language")in(p=v)?Object.defineProperty(p,d,{value:g,enumerable:!0,configurable:!0,writable:!0}):p[d]=g;var b=v;function m(e){return(m="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}var y={id:null,name:null,score:0,firstAirDate:null,url:null,originalName:null,inProduction:null,overview:null,poster:null,thumbnail:null,backdrop:null,genres:[],seasons:[]},w={id:null,name:null,episodesNb:0,number:null,overview:null,thumbnail:null,poster:null};function S(e,t){for(var n in e)void 0!==t[n]&&(e[n]=t[n])}function _(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0,n=Object.assign({},w);return"object"==m(e)&&S(n,e),void 0!==t&&(n.id=t),n}function T(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0,n=Object.assign({},y);return"object"==m(e)&&S(n,e),void 0!==t&&(n.id=t),n.genres=Array.isArray(n.genres)?n.genres.filter(function(e){return"string"==typeof e}):[],n.seasons=Array.isArray(n.seasons)?n.seasons.filter(function(e){return void 0!==e}).map(_):[],n.seasonsNb=n.seasons.length,n.episodesNb=n.seasons.reduce(function(e,t){return e+(parseInt(t.episodesNb)||0)},0),n}function x(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return void 0!==this.seasons[e.id]?(e=_(e),this.seasons[e.id]=e):(null==(e=_(e,this.seasons.length)).number&&(e.number=this.seasons.reduce(function(e,t){return Math.max(e,t.number)},0)+1),this.seasons.push(e)),e}function j(e){delete this.seasons[e]}function O(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};Object.assign(this,T(e)),this.setSeason=x,this.removeSeason=j}n.d(t,"sort",function(){return sort}),n.d(t,"filtering",function(){return filtering}),n.d(t,"sanitizedPage",function(){return sanitizedPage}),n.d(t,"getPage",function(){return getPage}),n.d(t,"query",function(){return query}),n.d(t,"TVShowsLibrary",function(){return N});var N=function(){var e={pageSize:20,page:0,sorting:{type:"name",isReversed:!1},genres:b.getGenres().reduce(function(e,t){return e[t]=!0,e},{}),selectedId:null,editedId:null};function t(e){var t,n,r,o,i=e.tvShows,s=e.settings,u=function(e,t){return e.filter(function(e){if(0===e.genres.length){for(var n in t)if(t[n])return!1;return!0}for(var r in e.genres)if(t[e.genres[r]])return!0;return!1})}((t=i.concat(),n=s.sorting,r=n.type,o=n.isReversed,t.sort(function(e,t){return e[r]===t[r]?0:o?e[r]<t[r]?1:-1:e[r]<t[r]?-1:1})),s.genres),l=u.length;return s.page=function(e,t){var n=t.pageSize,r=t.page;return Math.max(0,n*r>=e.length?Math.floor((e.length-1)/n):r)}(u,s),u=function(e,t){var n=t.pageSize,r=t.page;return e.slice(n*r,n*(r+1))}(u,s),{pagination:{page:s.page,pagesNb:Math.ceil(l/s.pageSize)},count:{nb:u.length,over:l,all:i.length},tvShows:u.map(function(e){return new O(e)})}}function n(e){return delete e.id,e}function r(e,t){var n=t.indexOf(e);return-1===n?null:n}var i=new function(){var i=localStorage?localStorage.getItem("TVShowsLibrary"):null,s=null==i?{tvShows:JSON.parse((new o).fetchSynchronously("https://iut-info.univ-reims.fr/users/jonquet/ressources/ihm/initialJSON.php")),settings:e}:JSON.parse(i),u=function(e){var t=e.tvShows[e.settings.selectedId],o=e.tvShows[e.settings.editedId];(e.tvShows=e.tvShows.filter(function(e){return e})).forEach(n),e.settings.selectedId=r(t,e.tvShows),e.settings.editedId=r(o,e.tvShows),localStorage.setItem("TVShowsLibrary",JSON.stringify(e))}.bind(null,s);s.tvShows.map(function(e,t){return e.id=t}),window.addEventListener("unload",u),this.clearLocalStorage=function(e){window.removeEventListener("unload",u),localStorage.removeItem("TVShowsLibrary"),e&&(window.location.href=e)};var l=null;this.query=t.bind(null,s),this.getGenres=function(e,t){var n={};for(var r in t)n[r]={name:r,isEnabled:t[r],nb:0};return e.forEach(function(e){return e.genres.forEach(function(e){return n[e].nb++})}),Object.keys(n).map(function(e){return n[e]})}.bind(null,s.tvShows,s.settings.genres),this.setAllFilters=function(e){var t=!!e;for(var n in s.settings.genres)s.settings.genres[n]=t},this.toggleFilter=function(e,t,n){void 0!==e[t]&&(e[t]="boolean"==typeof n?n:!e[t])}.bind(null,s.settings.genres),this.getGenresCount=function(e){var t=Object.values(e);return{activeNb:t.filter(function(e){return e}).length,over:t.length}}.bind(null,s.settings.genres),this.getSortingType=function(){return s.settings.sorting.type},this.setSortingType=function(e,t){void 0!==y[t]&&(e.type=t)}.bind(null,s.settings.sorting),this.isSortingReversed=function(){return s.settings.sorting.isReversed},this.toggleSortingReversed=function(e,t){e.isReversed="boolean"==typeof t?t:!e.isReversed}.bind(null,s.settings.sorting),this.setCurrentPage=function(e){return s.settings.page=e},this.getSelectedTVShow=function(e){return null===e.settings.selectedId?null:new O(e.tvShows[e.settings.selectedId])}.bind(null,s),this.setSelectedTVShow=function(e,t){void 0!==e.tvShows[t]&&(e.settings.selectedId=t)}.bind(null,s),this.getEditedTVShow=function(e){return new O(e.tvShows[e.settings.editedId])}.bind(null,s),this.setEditedTVShow=function(e,t){e.settings.editedId=t}.bind(null,s),this.removeTVShow=function(e,t){delete e.tvShows[t]}.bind(null,s),this.setTVShow=function(e,t){t instanceof O&&(e.tvShows[t.id]?e.tvShows[t.id]=T(t):e.tvShows.push(T(t,e.tvShows.length)))}.bind(null,s),this.setTMDBKey=function(e){return l=e},this.TMDBDetail=function(e){return null!==l?new O(b.detail(l,e)):null},this.TMDBSearch=function(e,t){return null!==l?b.search(l,e,t):null}};return function(){return i}}();N.getGenres=function(){return b.getGenres().concat()};t.default=N}]).default});
